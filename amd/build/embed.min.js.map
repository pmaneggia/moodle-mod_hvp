{"version":3,"sources":["../src/embed.js"],"names":["define","$","H5PEmbedCommunicator","document","ready","initEmbedCommunicator","resizeDelay","instance","H5P","instances","parentIsFriendly","on","send","iFrame","contentDocument","body","style","overflow","classList","add","trigger","scrollHeight","isFullscreen","clearTimeout","setTimeout","clientHeight","querySelector","contentWindow","console","warn","window","externalDispatcher","log"],"mappings":"AAeAA,OAAM,iBAAC,CAAC,QAAD,CAAW,sBAAX,CAAD,CAAqC,SAASC,CAAT,CAAYC,oBAAZ,CAAkC,CAGzED,CAAC,CAACE,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAAW,CACzBH,CAAC,CAAC,aAAD,CAAD,CAAiBG,KAAjB,CAAuB,UAAW,CAC9BC,qBAAqB,CAAG,gCAAW,IAC3BC,CAAAA,WAD2B,CAE3BC,QAAQ,CAAGC,GAAG,CAACC,SAAJ,CAAc,CAAd,CAFgB,CAG3BC,gBAAgB,GAHW,CAM/BR,oBAAoB,CAACS,EAArB,CAAwB,OAAxB,CAAiC,UAAW,CACxCT,oBAAoB,CAACU,IAArB,CAA0B,OAA1B,CACH,CAFD,EAKAV,oBAAoB,CAACS,EAArB,CAAwB,OAAxB,CAAiC,UAAW,CAExCD,gBAAgB,GAAhB,CAGAG,MAAM,CAACC,eAAP,CAAuBC,IAAvB,CAA4BC,KAA5B,CAAkCC,QAAlC,CAA6C,QAA7C,CAEAd,QAAQ,CAACY,IAAT,CAAcG,SAAd,CAAwBC,GAAxB,CAA4B,cAA5B,EAGAX,GAAG,CAACY,OAAJ,CAAYb,QAAZ,CAAsB,QAAtB,CACH,CAXD,EAcAL,oBAAoB,CAACS,EAArB,CAAwB,gBAAxB,CAA0C,UAAW,CACjDT,oBAAoB,CAACU,IAArB,CAA0B,QAA1B,CAAoC,CAChCS,YAAY,CAAER,MAAM,CAACC,eAAP,CAAuBC,IAAvB,CAA4BM,YADV,CAApC,CAGH,CAJD,EAMAnB,oBAAoB,CAACS,EAArB,CAAwB,QAAxB,CAAkC,UAAW,CACzCH,GAAG,CAACY,OAAJ,CAAYb,QAAZ,CAAsB,QAAtB,CACH,CAFD,EAIAC,GAAG,CAACG,EAAJ,CAAOJ,QAAP,CAAiB,QAAjB,CAA2B,UAAW,CAClC,GAAIC,GAAG,CAACc,YAAR,CAAsB,CAClB,MACH,CAGDC,YAAY,CAACjB,WAAD,CAAZ,CACAA,WAAW,CAAGkB,UAAU,CAAC,UAAW,CAEhC,GAAId,gBAAJ,CAAsB,CAClBR,oBAAoB,CAACU,IAArB,CAA0B,eAA1B,CACI,CACIS,YAAY,CAAER,MAAM,CAACC,eAAP,CAAuBC,IAAvB,CAA4BM,YAD9C,CAEII,YAAY,CAAEZ,MAAM,CAACC,eAAP,CAAuBC,IAAvB,CAA4BU,YAF9C,CADJ,CAMH,CAPD,IAOO,CACHvB,oBAAoB,CAACU,IAArB,CAA0B,OAA1B,CACH,CACJ,CAZuB,CAYrB,CAZqB,CAa3B,CApBD,EAuBAJ,GAAG,CAACY,OAAJ,CAAYb,QAAZ,CAAsB,QAAtB,CACH,CA3DD,CAD8B,GA6D1BM,CAAAA,MAAM,CAAGV,QAAQ,CAACuB,aAAT,CAAuB,aAAvB,CA7DiB,CA8D1BlB,GAAG,CAAGK,MAAM,CAACc,aAAP,CAAqBnB,GA9DD,CAgE9B,GAAI,CAACA,GAAD,EAAQ,CAACA,GAAG,CAACC,SAAb,EAA0B,CAACD,GAAG,CAACC,SAAJ,CAAc,CAAd,CAA/B,CAAiD,CAC7CmB,OAAO,CAACC,IAAR,CAAa,kHAAb,EACAC,MAAM,CAACtB,GAAP,CAAWuB,kBAAX,CAA8BpB,EAA9B,CAAiC,aAAjC,CAAgD,UAAgB,CAC5DiB,OAAO,CAACI,GAAR,CAAY,4CAAZ,EACAxB,GAAG,CAAGK,MAAM,CAACc,aAAP,CAAqBnB,GAA3B,CACAH,qBAAqB,EACxB,CAJD,CAKH,CAPD,IAOO,CACHA,qBAAqB,EACxB,CACJ,CA1ED,CA2EH,CA5ED,CA8EH,CAjFK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/* eslint-disable no-undef, no-console, no-unused-vars, max-len */\ndefine(['jquery', 'mod_hvp/communicator'], function($, H5PEmbedCommunicator) {\n\n    // Wait for instances to be initialize.\n    $(document).ready(function() {\n        $('.h5p-iframe').ready(function() {\n            initEmbedCommunicator = function() {\n                var resizeDelay;\n                var instance = H5P.instances[0];\n                var parentIsFriendly = false;\n\n                // Handle that the resizer is loaded after the iframe.\n                H5PEmbedCommunicator.on('ready', function() {\n                    H5PEmbedCommunicator.send('hello');\n                });\n\n                // Handle hello message from our parent window.\n                H5PEmbedCommunicator.on('hello', function() {\n                    // Initial setup/handshake is done.\n                    parentIsFriendly = true;\n\n                    // Hide scrollbars for correct size.\n                    iFrame.contentDocument.body.style.overflow = 'hidden';\n\n                    document.body.classList.add('h5p-resizing');\n\n                    // Content need to be resized to fit the new iframe size.\n                    H5P.trigger(instance, 'resize');\n                });\n\n                // When resize has been prepared tell parent window to resize.\n                H5PEmbedCommunicator.on('resizePrepared', function() {\n                    H5PEmbedCommunicator.send('resize', {\n                        scrollHeight: iFrame.contentDocument.body.scrollHeight\n                    });\n                });\n\n                H5PEmbedCommunicator.on('resize', function() {\n                    H5P.trigger(instance, 'resize');\n                });\n\n                H5P.on(instance, 'resize', function() {\n                    if (H5P.isFullscreen) {\n                        return; // Skip iframe resize.\n                    }\n\n                    // Use a delay to make sure iframe is resized to the correct size.\n                    clearTimeout(resizeDelay);\n                    resizeDelay = setTimeout(function() {\n                        // Only resize if the iframe can be resized.\n                        if (parentIsFriendly) {\n                            H5PEmbedCommunicator.send('prepareResize',\n                                {\n                                    scrollHeight: iFrame.contentDocument.body.scrollHeight,\n                                    clientHeight: iFrame.contentDocument.body.clientHeight\n                                }\n                            );\n                        } else {\n                            H5PEmbedCommunicator.send('hello');\n                        }\n                    }, 0);\n                });\n\n                // Trigger initial resize for instance.\n                H5P.trigger(instance, 'resize');\n            };\n            var iFrame = document.querySelector('.h5p-iframe');\n            var H5P = iFrame.contentWindow.H5P;\n            // Check for H5P instances.\n            if (!H5P || !H5P.instances || !H5P.instances[0]) {\n                console.warn(\"H5P embed.js: ACK! Embedded H5P.instances[0] in lowest iframe is not set up yet. Waiting for 'initialized' event\");\n                window.H5P.externalDispatcher.on('initialized', function(event) {\n                    console.log(\"H5P embed.js: 'initialized' event received\");\n                    H5P = iFrame.contentWindow.H5P;\n                    initEmbedCommunicator();\n                });\n            } else {\n                initEmbedCommunicator();\n            }\n        });\n    });\n\n});\n"],"file":"embed.min.js"}